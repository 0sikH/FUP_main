<!-- Ensure GSAP is loaded before running animation logic -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
<script>
  if (typeof lenis === 'undefined') {
    let lenis;
    window.addEventListener('DOMContentLoaded', () => {
      lenis = new Lenis();
      function raf(time) {
        lenis.raf(time);
        requestAnimationFrame(raf);
      }
      requestAnimationFrame(raf);
    });
  }

  gsap.registerPlugin(ScrollTrigger);

  const line1 = ["전략,", "실행,", "그리고", "확장"];
  const line2 = ["해외", "비즈니스의", "<span class='bold'>모든</span>", "<span class='bold'>단계</span>"];
  line1.forEach(w => {
    const span = document.createElement("span");
    span.innerHTML = w + " ";
    document.getElementById("line1")?.appendChild(span);
  });
  line2.forEach(w => {
    const span = document.createElement("span");
    span.innerHTML = w + " ";
    document.getElementById("line2")?.appendChild(span);
  });

  const timeline = gsap.timeline({
    scrollTrigger: {
      trigger: "#hero",
      start: "top top",
      end: "+=200%",
      scrub: true,
      pin: true
    }
  });

  timeline
    .to(".hero-subtitle span", { opacity: 1, y: 0, stagger: 0.1 }, 0)
    .to([".hero-title", ".hero-subtitle"], { opacity: 0 }, "+=0.3")
    .to(".hero-bg", { opacity: 1, scale: 1, duration: 1 }, "-=0.3");

  gsap.utils.toArray(".section").forEach(section => {
    const title = section.querySelector(".section-title");
    const subtitle = section.querySelector(".section-subtitle");
    const paragraph = section.querySelector(".section-text p");
    const items = section.querySelectorAll(".features li");

    if (title) {
      gsap.from(title, {
        scrollTrigger: { trigger: section, start: "top 85%" },
        y: 30, opacity: 0, duration: 1
      });
    }
    if (subtitle) {
      gsap.from(subtitle, {
        scrollTrigger: { trigger: subtitle, start: "top 90%" },
        y: 20, opacity: 0, duration: 1
      });
    }
    if (paragraph) {
      gsap.from(paragraph, {
        scrollTrigger: { trigger: paragraph, start: "top 80%" },
        y: 40, opacity: 0, duration: 1
      });
    }
    if (items.length) {
      gsap.from(items, {
        scrollTrigger: { trigger: section, start: "top 75%" },
        x: -30, opacity: 0, duration: 0.6, stagger: 0.2
      });
    }

    if (section.classList.contains("bg-ai")) {
      gsap.fromTo(section, {
        backgroundSize: "105%",
        opacity: 0.2
      }, {
        scrollTrigger: {
          trigger: section,
          start: "top center",
          end: "bottom center",
          scrub: true
        },
        backgroundSize: "100%",
        opacity: 1,
        ease: "power2.out"
      });
    }
  });
</script>
